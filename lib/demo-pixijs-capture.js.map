{"version":3,"sources":["demo-pixijs-capture.js"],"names":[],"mappings":"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","file":"demo-pixijs-capture.js","sourcesContent":["/**\n * Created by andrew on 12/18/15.\n */\n\nimport path from 'path';\nimport fs from 'fs';\nimport WwDrawingBrushManager from './ww-drawing-brush-manager';\nimport Rect from './rect';\nimport Point from './point';\nimport getTimer from './get-timer';\nimport WwDrawingHistoryBrushCommand from './ww-drawing-history-brush-command.js';\nimport WwDrawingHistory from './ww-drawing-history.js';\nimport WwDrawingHistoryRenderer from './ww-drawing-history-renderer.js';\nimport WwDrawingHistoryUnit from './ww-drawing-history-unit.js';\n\n\n\nlet brushes_path = path.join(__dirname, '../images/brushes/');\nconsole.log(brushes_path);\nlet brushes = require(path.join(brushes_path, 'brushes.json'));\nlet notepad = {};\n\nlet mouseDownHandler = null;\nlet mouseMoveHandler = null;\nlet mouseUpHandler = null;\n\nlet nextState = 'init';\nwindow.requestAnimationFrame(stateManager);\n\n\nfunction stateManager() {\n    //console.log(`StateManager: ${nextState}`);\n\n    switch (nextState) {\n        case 'init':\n            init();\n            nextState = null;\n            break;\n        case 'captureDrawing':\n            console.log('State: captureDrawing');\n            newRenderTexture();\n            captureMouseEvents();\n            nextState = 'render';\n            break;\n        case 'render':\n            notepad.pixiRenderer.render(notepad.stage);\n            break;\n        case 'replayDrawing':\n            console.log('State: replayDrawing');\n            replayDrawing();\n            break;\n        default:\n            break;\n    }\n\n    window.requestAnimationFrame(stateManager);\n}\n\nfunction init() {\n    console.log(`Initializing Pixijs`);\n    notepad.pixijsInitialized = true;\n    notepad.pixiRenderer = new PIXI.autoDetectRenderer(1280, 720, {\n        view: document.getElementById(\"demo-canvas\"),\n        backgroundColor: 0x000000,\n        antialias: true\n    });\n    notepad.stage = new PIXI.Container();\n\n    setupEvents();\n    loadBrushes();\n\n    let ui = document.getElementById('ui');\n    ui.innerHTML = 'Click & drag to draw...';\n}\n\nfunction onBrushesLoaded(brushes) {\n    console.log(`onBrushesLoaded:`);\n    console.log(brushes);\n    nextState = 'captureDrawing';\n}\n\nfunction loadBrushes() {\n\n    console.log(brushes);\n\n    brushes.path = brushes_path;\n\n    WwDrawingBrushManager.instance.init(onBrushesLoaded, 'pixijs', brushes);\n}\n\nfunction newRenderTexture() {\n    if (notepad.rtSprite) {\n        notepad.stage.removeChild(notepad.rtSprite);\n    }\n    if (notepad.renderTexture) {\n        notepad.renderTexture.destroy(true);\n    }\n    notepad.renderTexture = new PIXI.RenderTexture(notepad.pixiRenderer, 1280, 720);\n    notepad.rtSprite = new PIXI.Sprite(notepad.renderTexture);\n    notepad.stage.addChild(notepad.rtSprite);\n    notepad.pixiRenderer.render(notepad.stage);\n}\n\n\nfunction captureMouseEvents() {\n\n    notepad.commandTime = 0;\n    notepad.commandTimeStart = 0;\n    notepad.renderRect = new Rect(0, 0, 1280, 720); //(185, 466, 350, 350);\n\n    notepad.drawingHistory = null;\n    notepad.captureInProgress = false;\n\n    mouseDownHandler = onMouseDownHandler;\n}\n\nfunction addCommand(e) {\n    //console.log(`addCommand`);\n    if (notepad.captureInProgress) {\n        let location = new Point(e.pageX, e.pageY);\n        notepad.commandTime = getTimer() - notepad.commandTimeStart;\n        let command = new WwDrawingHistoryBrushCommand('hard', location, notepad.commandTime, null, 0.5, 1.0, 'normal', 0.3);\n        notepad.drawingHistoryUnit.addCommand(command);\n\n        //draw history so far\n        let temp_history = new WwDrawingHistory();\n        temp_history.addUnit(notepad.drawingHistoryUnit);\n        // TODO: Should only render un-rendered commands\n        let temp_renderer = new WwDrawingHistoryRenderer(temp_history, notepad.renderTexture, null, false, null);\n        temp_renderer.renderHistory();\n        notepad.pixiRenderer.render(notepad.stage);\n    }\n}\n\nfunction onMouseDownHandler(e) {\n    //console.log(`onMouseDownHandler: ${e.target.parent}`);\n\n    mouseDownHandler = null;\n    mouseUpHandler = onPressUpHandler;\n    mouseMoveHandler = onPressMoveHandler;\n\n    notepad.drawingHistory = new WwDrawingHistory();\n    notepad.drawingHistoryUnit = new WwDrawingHistoryUnit();\n    notepad.commandTimeStart = getTimer();\n    notepad.commandTime = 0;\n    notepad.captureInProgress = true;\n}\n\nfunction onPressMoveHandler(e) {\n    //console.log(`onPressMoveHandler: ${e.target.parent}`);\n    if (notepad.captureInProgress) {\n        addCommand(e);\n    }\n}\n\nfunction onPressUpHandler(e) {\n    //console.log(`onPressUpHandler: ${e.target.parent}`);\n    mouseUpHandler = null;\n    mouseMoveHandler = null;\n\n    if (notepad.captureInProgress) {\n        notepad.drawingHistory.addUnit(notepad.drawingHistoryUnit);\n        console.log(notepad.drawingHistory);\n        notepad.captureInProgress = false;\n    }\n\n    newRenderTexture();\n    notepad.renderRect = new Rect(0, 0, 1280, 720); //(185, 466, 350, 350);\n    notepad.drawingRenderer = new WwDrawingHistoryRenderer(notepad.drawingHistory, notepad.renderTexture, notepad.renderRect, true, null);\n    writeDrawingJSON();\n    nextState = 'replayDrawing';\n}\n\nfunction writeDrawingJSON() {\n    let drawing_path = path.join(__dirname, '../images/drawings/captured-drawing.json');\n    console.log(notepad.drawingHistory.json);\n    let data = JSON.stringify(notepad.drawingHistory.json);\n    fs.writeFile(drawing_path, data, function (err) {\n        if (err) {\n            return console.log(err);\n        }\n    });\n}\n\n\nfunction replayDrawing() {\n    if (notepad.drawingRenderer.ended) {\n        nextState = 'captureDrawing';\n    } else {\n        notepad.drawingRenderer.renderHistoryWithDuration(33);\n        notepad.pixiRenderer.render(notepad.stage);\n    }\n\n    //notepad.drawingRenderer.renderHistory();\n    //notepad.pixiRenderer.render(notepad.stage);\n    //nextState = 'captureDrawing';\n}\n\n\n// EVENTS\nlet isMouseDown = false;\n\nfunction setupEvents() {\n    console.log(`Adding Mouse Events`);\n    document.onmousedown = mouseDown;\n    document.onmouseup = mouseUp;\n    document.onmousemove = mouseMove;\n}\n\n//// GLOBAL EVENTS\n\nfunction mouseDown(e) {\n    //console.log(`mouseDown: ${e.pageX}, ${e.pageY}`);\n    isMouseDown = true;\n    if (mouseDownHandler) {\n        mouseDownHandler(e);\n    }\n\n}\n\nfunction mouseUp(e) {\n    //console.log(`mouseUp (pressup): ${e.pageX}, ${e.pageY}`);\n    isMouseDown = false;\n    if (mouseUpHandler) {\n        mouseUpHandler(e);\n    }\n\n}\n\nfunction mouseMove(e) {\n    if (isMouseDown) {\n        //console.log(`mouseMove (pressmove):`);\n        if (mouseMoveHandler) {\n            mouseMoveHandler(e);\n        }\n    }\n}"],"sourceRoot":"/source/"}