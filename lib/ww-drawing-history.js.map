{"version":3,"sources":["ww-drawing-history.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;oCAUgC,2BAA2B;;;;4BAClC,kBAAkB;;;;IAErC,gBAAgB;AACP,aADT,gBAAgB,GACJ;8BADZ,gBAAgB;;AAEd,YAAI,CAAC,KAAK,GAAG,EAAE,CAAC;AAChB,YAAI,CAAC,SAAS,GAAG,CAAC,CAAC;AACnB,YAAI,CAAC,QAAQ,GAAG,CAAC,CAAC;KACrB;;iBALC,gBAAgB;;eAOV,oBACR;AACI,gBAAI,MAAM,GAAG,SAAS,GAAG,IAAI,CAAC,SAAS,GAAG,cAAc,GAAG,IAAI,CAAC,QAAQ,GAAG,SAAS,IAAI,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,QAAQ,CAAA,AAAC,GAAG,IAAI,CAAC;AAC/H,gBAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAA,IAAI,EAAI;AACvB,sBAAM,IAAI,IAAI,CAAC,QAAQ,EAAE,CAAC;aAC7B,CAAC,CAAC;AACH,mBAAO,MAAM,CAAC;SACjB;;;eAEM,iBAAC,IAAI,EACZ;AACI,gBAAI,IAAI,EACR;AACI,oBAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;AACtB,oBAAI,CAAC,cAAc,IAAI,IAAI,CAAC,UAAU,CAAC;AACvC,oBAAI,CAAC,QAAQ,IAAI,IAAI,CAAC,QAAQ,CAAC;aAClC,MAED;AACI,uBAAO,CAAC,GAAG,0CAA0C,CAAC;aACzD;SACJ;;;eAGgB,6BAAe;;;gBAAd,KAAK,gCAAG,IAAI;;AAC1B,gBAAI,IAAI,GAAG,uCAA0B,CAAC;AACtC,gBAAI,sBAAsB,GAAG,CAAC,CAAC;;AAE/B,gBAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAA,SAAS,EAAI;AAC5B,oBAAI,SAAS,EAAE;AACX,6BAAS,CAAC,QAAQ,CAAC,OAAO,CAAC,UAAA,YAAY,EAAI;;;;;;;;;AASvC,oCAAY,CAAC,aAAa,IAAI,sBAAsB,CAAC;AACrD,8BAAK,QAAQ,GAAG,IAAI,CAAC,GAAG,CAAC,MAAK,QAAQ,EAAE,YAAY,CAAC,aAAa,CAAC,CAAC;AACpE,4BAAI,KAAK,EAAE;AACP,gCAAI,KAAK,IAAI,YAAY,CAAC,OAAO,EAAE;AAC/B,oCAAI,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;6BAC/C;yBACJ,MACI;AACD,gCAAI,CAAC,UAAU,CAAC,YAAY,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;yBAC/C;qBACJ,CAAC,CAAC;AACH,0CAAsB,IAAI,SAAS,CAAC,QAAQ,CAAC;iBAChD;aACJ,CAAC,CAAC;;AAEH,mBAAO,IAAI,CAAC;SACf;;;WA9DC,gBAAgB;;;qBAiEP,gBAAgB","file":"ww-drawing-history.js","sourcesContent":["/**\n * Created by andrew on 8/13/15.\n */\n\n/**\n * ...\n * @author Andrew Rapo (andrew@worthwhilegames.org)\n * @license MIT\n */\n\nimport WwDrawingHistoryUnit from'./ww-drawing-history-unit';\nimport WwDeviceInfo from './ww-device-info';\n\nclass WwDrawingHistory {\n    constructor() {\n        this.units = [];\n        this.startTime = 0;\n        this.duration = 0;\n    }\n\n    toString()\n    {\n        let result = \"Start: \" + this.startTime + \", duration: \" + this.duration + \", end: \" + (this.startTime + this.duration) + \"\\n\";\n        this.units.forEach(unit => {\n            result += unit.toString();\n        });\n        return result;\n    }\n\n    addUnit(unit)\n    {\n        if (unit)\n        {\n            this.units.push(unit);\n            this.unitLineLength += unit.lineLength;\n            this.duration += unit.duration;\n        }\n        else\n        {\n            console.log(`WwDrawingHistory:addUnit: unit is null`);\n        }\n    }\n\n\n    concatAllCommands(layer = null) {\n        let unit = new WwDrawingHistoryUnit();\n        let unit_start_time_offset = 0;\n\n        this.units.forEach(temp_unit => {\n            if (temp_unit) {\n                temp_unit.commands.forEach(temp_command => {\n                    /*\n                    if (this.startTime == 0) {\n                        this.startTime = temp_command.executionTime;\n                    }\n                    else {\n                        this.startTime = Math.min(this.startTime, temp_command.executionTime);\n                    }\n                    */\n                    temp_command.executionTime += unit_start_time_offset;\n                    this.duration = Math.max(this.duration, temp_command.executionTime);\n                    if (layer) {\n                        if (layer == temp_command.layerID) {\n                            unit.addCommand(temp_command, false, false);//, false, false);\n                        }\n                    }\n                    else {\n                        unit.addCommand(temp_command, false, false);//, false, false);\n                    }\n                });\n                unit_start_time_offset += temp_unit.duration;\n            }\n        });\n\n        return unit;\n    }\n}\n\nexport default WwDrawingHistory;\n\n/*\n\n package org.wwlib.drawing\n {\n import org.wwlib.utils.WwDebug;\n import org.wwlib.utils.WwDeviceInfo;\n\n\npublic class WwDrawingHistory\n{\n    private var __debug:WwDebug;\n    private var __units:Vector.<WwDrawingHistoryUnit>;\n    private var __startTime:int;\n    private var __duration:int;\n    private var __timeScale:Number = 1.0;\n    private var __id:int;\n    private var __unitLineLength:Number;\n    private var __sessions:Vector.<WwDrawingHistorySession>;\n\n    private var __json:Object = null;\n\n    public function WwDrawingHistory()\n    {\n        __debug = WwDebug.instance;\n        __units = new Vector.<WwDrawingHistoryUnit>;\n        __startTime = 0;\n        __duration = 0;\n        __unitLineLength = 0;\n        __sessions = new Vector.<WwDrawingHistorySession>;\n    }\n\n    public function addUnit(_unit:WwDrawingHistoryUnit):void\n    {\n\n        if (_unit)\n        {\n            //__debug.msg(\"QcColoringHistory:addUnit: \" + _unit.id, \"6\");\n            __units.push(_unit);\n            __unitLineLength += _unit.lineLength;\n            __duration += _unit.duration;\n        }\n        else\n        {\n            __debug.msg(\"WwDrawingHistory:addUnit: unit is null\", \"6\");\n        }\n    }\n\n    public function removeLastUnit():WwDrawingHistoryUnit\n    {\n        var unit:WwDrawingHistoryUnit = __units.pop();\n        if (unit)\n        {\n            __unitLineLength -= unit.lineLength;\n            __duration -= unit.duration;\n        }\n\n        return unit;\n    }\n\n    public static function MERGE_HISTORIES(_history1:WwDrawingHistory, _history2:WwDrawingHistory, _history3:WwDrawingHistory):WwDrawingHistory\n    {\n        var new_history:WwDrawingHistory = new WwDrawingHistory;\n        var unit:WwDrawingHistoryUnit;\n\n        for each (unit in _history1.units)\n        {\n            new_history.addUnit(unit);\n        }\n\n        for each (unit in _history2.units)\n        {\n            new_history.addUnit(unit);\n        }\n\n        for each (unit in _history3.units)\n        {\n            new_history.addUnit(unit);\n        }\n\n        return new_history;\n    }\n\n    public function sortUnitsByStartTime():void\n    {\n        __units = __units.sort(sortCompareUnitStartTime);\n    }\n\n    private function sortCompareUnitStartTime(_unit1:WwDrawingHistoryUnit, _unit2:WwDrawingHistoryUnit):Number\n    {\n        return _unit1.startTime - _unit2.startTime;\n    }\n\n    public function debugTime():String\n    {\n        var result:String = \"History: \" + __id + \": start: \" + __startTime + \", duration: \" + __duration + \", end: \" + (__startTime + __duration) + \"\\n\";\n        for each (var _unit:WwDrawingHistoryUnit in __units)\n        {\n            result += _unit.debugTime();\n        }\n        return result;\n    }\n\n    public function concatAllCommands(layer:String=null):WwDrawingHistoryUnit\n    {\n        var _unit:WwDrawingHistoryUnit = new WwDrawingHistoryUnit();\n\n        for each (var temp_unit:WwDrawingHistoryUnit in __units)\n        {\n            if (temp_unit)\n            {\n                for each (var temp_command:WwDrawingHistoryBrushCommand in temp_unit.commands)\n                {\n                    if (__startTime == 0)\n                    {\n                        __startTime = temp_command.executionTime;\n                    }\n                    else\n                    {\n                        __startTime = Math.min(__startTime, temp_command.executionTime);\n                    }\n                    __duration = Math.max(__duration, temp_command.executionTime);\n                    if (_layer)\n                    {\n                        if (_layer == temp_command.layerID)\n                        {\n                            _unit.addCommand(temp_command, false, false);//, false, false);\n                        }\n                    }\n                    else\n                    {\n                        _unit.addCommand(temp_command, false, false);//, false, false);\n                    }\n                }\n            }\n        }\n\n        return _unit;\n    }\n\n    public function deleteUnitsByLayerID(_id:String):void\n    {\n        var _new_unit_list:Vector.<WwDrawingHistoryUnit> = new Vector.<WwDrawingHistoryUnit>;\n\n        for each (var temp_unit:WwDrawingHistoryUnit in __units)\n        {\n            if (temp_unit)\n            {\n                if (temp_unit.layerID != _id)\n                {\n                    _new_unit_list.push(temp_unit);\n                }\n                else\n                {\n                    temp_unit.dispose();\n                }\n            }\n        }\n\n        __units = _new_unit_list;\n    }\n\n*/\n\n/*\n\n    public function get json():Object\n    {\n        __json = new Object();\n        __json.id = __id;\n        __json.start = startTime;\n        __json.end = duration;\n        __json.scale = WwDeviceInfo.instance.assetScaleFactor;\n\n        // units\n        var _units:Array = new Array();\n        for each (var _unit:WwDrawingHistoryUnit in __units)\n        {\n            _units.push(_unit.json);\n        }\n        __json.units = _units;\n\n        // sessions\n        var _sessions:Array = [];\n        for each (var _session:WwDrawingHistorySession in __sessions)\n        {\n            _sessions.push(_session.json);\n        }\n        __json.sessions = _sessions;\n\n        // add redundant stats - most recent - for inclusion in fdl\n        __json.stats = _session.stats.json;\n\n        return __json;\n    }\n\n    public function reset():void\n    {\n        __units = new Vector.<WwDrawingHistoryUnit>;\n        __startTime = 0;\n    }\n\n    public function debug():void\n    {\n        //__debug.clear();\n        __debug.msg(\"History: debug: \" + __units.length, \"1\");\n        for each (var temp_unit:WwDrawingHistoryUnit in __units)\n        {\n            __debug.msg(\"  \" + temp_unit.startTime, \"1\");\n        }\n    }\n\n    public function dispose():void\n    {\n        for each (var _unit:WwDrawingHistoryUnit in __units)\n        {\n            _unit.dispose();\n        }\n        __units = null;\n    }\n\n    public function get units():Vector.<WwDrawingHistoryUnit>\n{\n        return __units\n}\n\npublic function set units(_units:Vector.<WwDrawingHistoryUnit>):void\n{\n    __units = _units;\n}\n\npublic function get unitCount():int\n{\n    return __units.length;\n}\n\n\npublic function get startTime():int\n{\n    return __startTime;\n}\n\npublic function get timeScale():Number\n{\n    return __timeScale;\n}\n\npublic function set timeScale(value:Number):void\n{\n    __timeScale = value;\n    for each (var temp_unit:WwDrawingHistoryUnit in __units)\n    {\n        temp_unit.timeScale = __timeScale;\n    }\n}\n\npublic function get scaledDuration():int\n{\n    return __duration * __timeScale;\n}\n\npublic function get duration():int\n{\n    return __duration;\n}\n\npublic function set duration(value:int):void\n{\n    __duration = value;\n}\n\npublic function get unitLineLength():Number\n{\n    return __unitLineLength;\n}\n\npublic function get sessions():Vector.<WwDrawingHistorySession>\n{\n    return __sessions;\n}\n\npublic function set sessions(value:Vector.<WwDrawingHistorySession>):void\n{\n    __sessions = value;\n}\n\n\n}\n}\n */"],"sourceRoot":"/source/"}